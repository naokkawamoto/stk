<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>案件管理（現地調査）</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <style>
        /* 全体左右マージン */
        .content-wrapper {
        margin: 0 auto;
        padding: 0 1rem;
        }
        /* カードを小さく */
        .card-project {
        font-size: 0.75rem;
        }
        .card-project .card-header {
        padding: 0.4rem 0.6rem;
        }
        .card-project .card-body {
        padding: 0.5rem;
        }
        .card-project .btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;
        }
    </style>
    </head>
    <body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <div class="content-wrapper mt-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <h5 class="mb-0">会社名</h5>
            <h4 class="mb-0 d-inline">案件名 <i class="bi bi-star"></i></h4>
        </div>
        <div class="text-end">
            <span class="me-2">案件フロー:</span>
            <select class="form-select form-select-sm me-2" style="width:auto; display:inline-block;">
            <option>案件登録中</option>
            <option selected>現地調査中</option>
            <option>プラン中</option>
            <option>提案完了</option>
            </select>
            <button class="btn btn-outline-primary btn-sm">変更</button>
        </div>
        </div>

        <div class="d-flex justify-content-end mb-3">
        <span class="badge bg-light text-dark me-2">案件登録中</span>
        <span class="badge bg-primary me-2">現地調査中</span>
        <span class="badge bg-light text-dark me-2">プラン中</span>
        <span class="badge bg-light text-dark">提案完了</span>
        </div>

        <!-- ナビゲーションタブ -->
        <ul class="nav nav-tabs mb-4">
        <li class="nav-item"><a class="nav-link"      href="user_project_detail.html">概要</a></li>
        <li class="nav-item"><a class="nav-link" href="user_project_detail_investigate.html">現地調査</a></li>
        <li class="nav-item"><a class="nav-link"      href="user_project_detail_designlist.html">プラン一覧</a></li>
        <li class="nav-item"><a class="nav-link active"      href="user_project_detail_doc.html">お客様資料</a></li>
        <li class="nav-item"><a class="nav-link"      href="user_project_detail_chat.html">チャット <span class="badge bg-danger">5</span></a></li>
        <li class="nav-item"><a class="nav-link"      href="user_project_detail_expartner.html">外部業務依頼</a></li>
        </ul>

        <!-- タイトル -->
    <div class="mb-2">
        <h4>現地調査</h4>
      </div>
  
      <!-- パンくずリスト -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb small-text mb-0">
          <li class="breadcrumb-item">
            <a href="user_project_detail_doc.html" class="text-decoration-none">お客様資料</a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">現地調査</li>
        </ol>
      </nav>
  
      <!-- テーブル（購読者等の構成は user_project_detail_design_detail_doc_detail.html と同様） -->
      <div class="table-responsive small-text mb-4">
        <table class="table table-hover table-bordered mb-0">
          <thead class="table-light">
            <tr>
              <th>資料名称</th>
              <th>項目数</th>
              <th>社内（購読）</th>
              <th>協力業者（購読）</th>
              <th>施主（購読）</th>
              <th>作成者</th>
              <th>更新日時</th>
              <th>アクション</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>案件名_現地調査報告書_20250507</td>
              <td>1</td>
              <td>
                <button class="btn btn-sm btn-outline-secondary" onclick="openPrivacyModal('案件名_現地調査報告書_20250507', 'staff')">公開</button>
                <button class="btn btn-link p-0 small-text align-baseline" data-bs-toggle="modal" data-bs-target="#subscribersModalStaff">（3）</button>
              </td>
              <td>
                <button class="btn btn-sm btn-outline-secondary" onclick="openPrivacyModal('案件名_現地調査報告書_20250507', 'partner')">公開</button>
                <button class="btn btn-link p-0 small-text align-baseline" data-bs-toggle="modal" data-bs-target="#subscribersModalPartner">（3）</button>
              </td>

              <td>
                <button class="btn btn-sm btn-outline-secondary" onclick="openPrivacyModal('案件名_現地調査報告書_20250507', 'client')">公開</button>
                <button class="btn btn-link p-0 small-text align-baseline" data-bs-toggle="modal" data-bs-target="#subscribersModalClient">（2）</button>
              </td>
              <td>山田 太郎</td>
              <td>2025/05/07 15:00</td>
              <td>
                <button class="btn btn-sm btn-outline-primary me-1">
                  <i class="bi bi-file-earmark-arrow-down"></i> ダウンロード
                </button>
                <button class="btn btn-sm btn-outline-info" onclick="openViewModal('案件名_現地調査報告書_20250507')">
                  <i class="bi bi-eye"></i> 表示
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <!-- 社内購読者モーダル -->
      <div class="modal fade" id="subscribersModalStaff" tabindex="-1" aria-labelledby="subscribersModalStaffLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="subscribersModalStaffLabel">社内購読者一覧</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body small-text">
              <ul class="list-unstyled mb-0">
                <li>1. 東京本社 営業部 山田 太郎</li>
                <li>2. 大阪支店 設計部 鈴木 一郎</li>
                <li>3. 名古屋支店 工務部 佐藤 次郎</li>
              </ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">閉じる</button>
            </div>
          </div>
        </div>
      </div>
      <!-- 協力業者購読者モーダル -->
      <div class="modal fade" id="subscribersModalPartner" tabindex="-1" aria-labelledby="subscribersModalPartnerLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="subscribersModalPartnerLabel">協力業者購読者一覧</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body small-text">
              <ul class="list-unstyled mb-0">
                <li>1. 株式会社ABC建設 工事担当 田中 三郎</li>
                <li>2. 株式会社XYZ設計 設計担当 高橋 四郎</li>
                <li>3. 株式会社123設備 設備担当 伊藤 五郎</li>
              </ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">閉じる</button>
            </div>
          </div>
        </div>
      </div>


      <!-- 施主購読者モーダル -->
      <div class="modal fade" id="subscribersModalClient" tabindex="-1" aria-labelledby="subscribersModalClientLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="subscribersModalClientLabel">施主購読者一覧</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body small-text">
              <ul class="list-unstyled mb-0">
                <li>1. 田中 太郎（代表者）</li>
                <li>2. 田中 花子（担当者）</li>
              </ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">閉じる</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 公開設定変更モーダル -->
      <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="privacyModalLabel">公開設定の変更</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label"><strong id="modalDocumentName"></strong></label>
                <div class="text-muted small" id="modalPrivacyType"></div>
              </div>
              <div class="mb-3">
                <label class="form-label">公開設定を選択してください：</label>
                <div class="d-grid gap-2" id="privacyOptions">
                  <!-- オプションはJavaScriptで動的に生成 -->
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
              <button type="button" class="btn btn-primary" id="savePrivacyBtn" onclick="savePrivacy()" disabled>保存</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 表示モーダル -->
      <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="viewModalLabel">資料表示</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 id="viewDocumentName">案件名_現地調査報告書_20250507</h6>
                  <div>
                    <button class="btn btn-sm btn-outline-primary me-2">
                      <i class="bi bi-download"></i> ダウンロード
                    </button>
                    <button class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-printer"></i> 印刷
                    </button>
                  </div>
                </div>
              </div>
              <div class="border rounded p-3" style="min-height: 500px; background-color: #f8f9fa;">
                <div class="text-center py-5">
                  <i class="bi bi-file-earmark-text display-1 text-muted"></i>
                  <h5 class="mt-3 text-muted">PDFビューアー</h5>
                  <p class="text-muted">実際の実装では、ここにPDFビューアーや画像ビューアーが表示されます。</p>
                  <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm me-2">
                      <i class="bi bi-zoom-in"></i> 拡大
                    </button>
                    <button class="btn btn-outline-primary btn-sm me-2">
                      <i class="bi bi-zoom-out"></i> 縮小
                    </button>
                    <button class="btn btn-outline-primary btn-sm">
                      <i class="bi bi-arrows-fullscreen"></i> 全画面
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
            </div>
          </div>
        </div>
      </div>

    <!-- フッター -->
    <div id="footer-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- カスタムスクリプト -->
    <script src="../style.js"></script>
    <script>
        fetch('user_header.html').then(r => r.text()).then(html => document.getElementById('header-container').innerHTML = html);
        fetch('user_footer.html').then(r => r.text()).then(html => document.getElementById('footer-container').innerHTML = html);

        // 公開設定変更モーダルの制御
        let currentDocument = '';
        let currentPrivacyType = '';
        let selectedPrivacy = '';
        
        function openPrivacyModal(documentName, privacyType) {
          currentDocument = documentName;
          currentPrivacyType = privacyType;
          selectedPrivacy = '';
          
          // モーダルのタイトルと説明を設定
          document.getElementById('modalDocumentName').textContent = documentName;
          
          let privacyTypeText = '';
          switch(privacyType) {
            case 'staff':
              privacyTypeText = '社内公開設定';
              break;
            case 'partner':
              privacyTypeText = '協力業者公開設定';
              break;
            case 'client':
              privacyTypeText = '施主公開設定';
              break;
          }
          document.getElementById('modalPrivacyType').textContent = privacyTypeText;
          
          // 公開設定オプションを動的に生成
          generatePrivacyOptions(privacyType);
          
          // 保存ボタンを無効化
          document.getElementById('savePrivacyBtn').disabled = true;
          
          // モーダルを表示
          const modal = new bootstrap.Modal(document.getElementById('privacyModal'));
          modal.show();
        }
        
        function generatePrivacyOptions(privacyType) {
          const optionsContainer = document.getElementById('privacyOptions');
          optionsContainer.innerHTML = '';
          
          // すべての公開設定で公開と非公開のオプションを提供
          optionsContainer.innerHTML = `
            <button type="button" class="btn btn-outline-primary text-start" onclick="selectPrivacy('公開')">
              <i class="bi bi-eye me-2"></i>
              <strong>公開</strong>
              <div class="small text-muted">すべての${getPrivacyTypeText(privacyType)}が閲覧可能</div>
            </button>
            <button type="button" class="btn btn-outline-secondary text-start" onclick="selectPrivacy('非公開')">
              <i class="bi bi-lock me-2"></i>
              <strong>非公開</strong>
              <div class="small text-muted">閲覧不可</div>
            </button>
          `;
        }
        
        function getPrivacyTypeText(privacyType) {
          switch(privacyType) {
            case 'staff':
              return '社内ユーザー';
            case 'partner':
              return '協力業者';
            case 'client':
              return '施主';
            default:
              return 'ユーザー';
          }
        }
        
        function selectPrivacy(privacy) {
          selectedPrivacy = privacy;
          
          // 保存ボタンを有効化
          document.getElementById('savePrivacyBtn').disabled = false;
          
          // 選択されたボタンのスタイルを更新
          document.querySelectorAll('#privacyModal .btn-outline-primary, #privacyModal .btn-outline-warning, #privacyModal .btn-outline-secondary').forEach(btn => {
            btn.classList.remove('active');
          });
          
          // クリックされたボタンをアクティブにする
          event.target.closest('.btn').classList.add('active');
        }
        
        function savePrivacy() {
          if (!selectedPrivacy) {
            alert('公開設定を選択してください。');
            return;
          }
          
          // 保存処理（ダミー）
          let privacyTypeText = getPrivacyTypeText(currentPrivacyType);
          alert(`${currentDocument}の${privacyTypeText}公開設定を「${selectedPrivacy}」に変更しました。`);
          
          // モーダルを閉じる
          const modal = bootstrap.Modal.getInstance(document.getElementById('privacyModal'));
          modal.hide();
          
          // 実際の実装では、ここでサーバーに設定を保存し、ボタンの表示を更新する
        }
        
        // 表示モーダルを開く関数
        function openViewModal(documentName) {
          // モーダルのタイトルを設定
          document.getElementById('viewDocumentName').textContent = documentName;
          
          // モーダルを表示
          const modal = new bootstrap.Modal(document.getElementById('viewModal'));
          modal.show();
        }
    </script>
</body>
</html>
