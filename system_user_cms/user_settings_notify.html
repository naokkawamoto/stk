<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>システム設定</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <!-- カスタムCSS -->
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <div class="container-fluid mt-4">
        <h3 class="mb-3">システム設定</h3>
        <!-- メインタブ -->
        <ul class="nav nav-tabs mb-3" id="settingsTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings.html" role="tab">案件登録設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings.html#tab-investigate" role="tab">現地調査設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings.html#tab-questionnaire" role="tab">アンケート設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings.html#tab-plan" role="tab">プラン設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings_quote.html" role="tab">見積もり設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_settings_finance.html" role="tab">資金計画設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link active" href="user_settings_notify.html" role="tab">通知設定</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="user_permission.html" role="tab">ユーザー権限設定</a>
            </li>
        </ul>
        
        <div class="p-4">
            <table class="table table-striped small mb-0">
                <thead>
                    <tr>
                        <th>通知項目</th>
                        <th>ON／OFF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>案件新規作成</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" checked>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>案件ステータス変更</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>プラン新規作成</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" checked>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>プランステータス変更</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>業者見積もり依頼</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>業者見積もり提出</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" checked>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>見積もりステータス変更</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>資金計画ステータス変更</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>チャットで自分と自分を含むグループ宛に受信ある場合</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" checked>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>お知らせがある場合</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>見積もり上長承認または却下</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>資金計画上長承認または却下</td>
                        <td>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox">
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 保存ボタン -->
        <div class="text-end mt-3">
            <button class="btn btn-primary btn-sm">設定を保存</button>
        </div>
    </div>

    <!-- フッター -->
    <div id="footer-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- カスタムスクリプト -->
    <script src="../style.js"></script>
    <script>
        fetch('user_header.html').then(r=>r.text()).then(html=>document.getElementById('header-container').innerHTML=html);
        fetch('user_footer.html').then(r=>r.text()).then(html=>document.getElementById('footer-container').innerHTML=html);
        
        // ページ離脱時のアラート機能
        let hasUnsavedChanges = true; // ダミーで常にtrueに設定
        
        // ページ離脱時の確認
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '保存されていない変更があります。このページを離れますか？';
                return '保存されていない変更があります。このページを離れますか？';
            }
        });
        
        // リンククリック時の確認
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.href && !e.target.href.includes('#')) {
                if (hasUnsavedChanges) {
                    if (!confirm('保存されていない変更があります。このページを離れますか？')) {
                        e.preventDefault();
                        return false;
                    }
                }
            }
        });
        
        // 設定保存ボタンクリック時の処理（ダミー）
        document.addEventListener('click', function(e) {
            if (e.target.closest('.btn-success') && e.target.closest('.btn-success').textContent.includes('設定保存')) {
                hasUnsavedChanges = false;
                alert('設定が保存されました。');
                
                // 3秒後に再度変更がある状態に戻す（ダミー用）
                setTimeout(() => {
                    hasUnsavedChanges = true;
                }, 3000);
            }
        });
    </script>
</body>
</html>
