<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外部業務依頼設定</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../style.css">
    <style>
        .partner-card {
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
        }
        .partner-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .partner-card.active {
            border-left-color: #28a745;
        }
        .partner-card.inactive {
            border-left-color: #dc3545;
        }
        .status-badge {
            font-size: 0.8rem;
        }
        .service-tag {
            background-color: #e9ecef;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            margin: 2px;
            display: inline-block;
        }
        .contact-info {
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <div class="container-fluid mt-4 px-3">
        <!-- ページタイトル -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0">外部業務依頼設定</h4>
            <button class="btn btn-primary" onclick="openAddPartnerModal()">
                <i class="bi bi-plus-circle"></i> 新規登録
            </button>
        </div>


        <!-- 外部業務依頼一覧 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">外部業務依頼一覧</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 20%;">依頼したい業務</th>
                                <th style="width: 15%;">会社名</th>
                                <th style="width: 10%;">名前</th>
                                <th style="width: 10%;">名前（カナ）</th>
                                <th style="width: 15%;">メール</th>
                                <th style="width: 12%;">電話番号</th>
                                <th style="width: 18%;">PDF添付</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- BELS依頼 -->
                            <tr>
                                <td>BELS依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="佐々木 亮" onchange="updatePartnerInfo(1, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="ササキ リョウ" onchange="updatePartnerInfo(1, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="ryo.sasaki@cadcenter.co.jp" onchange="updatePartnerInfo(1, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-5678-1234" onchange="updatePartnerInfo(1, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(1, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(1)" style="display: none;" id="previewBtn1">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- CGパースを依頼 -->
                            <tr>
                                <td>CGパースを依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="田中 美咲" onchange="updatePartnerInfo(2, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="タナカ ミサキ" onchange="updatePartnerInfo(2, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="misaki.tanaka@cadcenter.co.jp" onchange="updatePartnerInfo(2, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-1234-5678" onchange="updatePartnerInfo(2, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(2, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(2)" style="display: none;" id="previewBtn2">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 省エネ計算依頼 -->
                            <tr>
                                <td>省エネ計算依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="佐藤 健一" onchange="updatePartnerInfo(3, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="サトウ ケンイチ" onchange="updatePartnerInfo(3, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="kenichi.sato@cadcenter.co.jp" onchange="updatePartnerInfo(3, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-2345-6789" onchange="updatePartnerInfo(3, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(3, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(3)" style="display: none;" id="previewBtn3">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 構造計算依頼 -->
                            <tr>
                                <td>構造計算依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="山田 太郎" onchange="updatePartnerInfo(4, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="ヤマダ タロウ" onchange="updatePartnerInfo(4, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="taro.yamada@cadcenter.co.jp" onchange="updatePartnerInfo(4, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-3456-7890" onchange="updatePartnerInfo(4, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(4, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(4)" style="display: none;" id="previewBtn4">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 長期優良住宅申請依頼 -->
                            <tr>
                                <td>長期優良住宅申請依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="鈴木 花子" onchange="updatePartnerInfo(5, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="スズキ ハナコ" onchange="updatePartnerInfo(5, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="hanako.suzuki@cadcenter.co.jp" onchange="updatePartnerInfo(5, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-4567-8901" onchange="updatePartnerInfo(5, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(5, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(5)" style="display: none;" id="previewBtn5">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 確認申請依頼 -->
                            <tr>
                                <td>確認申請依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="高橋 次郎" onchange="updatePartnerInfo(6, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="タカハシ ジロウ" onchange="updatePartnerInfo(6, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="jiro.takahashi@cadcenter.co.jp" onchange="updatePartnerInfo(6, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-5678-9012" onchange="updatePartnerInfo(6, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(6, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(6)" style="display: none;" id="previewBtn6">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 性能評価依頼 -->
                            <tr>
                                <td>性能評価依頼</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="佐藤 未来" onchange="updatePartnerInfo(7, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="サトウ ミライ" onchange="updatePartnerInfo(7, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="mirai.sato@cadcenter.co.jp" onchange="updatePartnerInfo(7, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="03-6789-2345" onchange="updatePartnerInfo(7, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(7, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(7)" style="display: none;" id="previewBtn7">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>
                            <!-- 意匠図を依頼する -->
                            <tr>
                                <td>意匠図を依頼する</td>
                                <td>株式会社CADセンター</td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="" onchange="updatePartnerInfo(8, 'name', this.value)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" value="" onchange="updatePartnerInfo(8, 'kana', this.value)">
                                </td>
                                <td>
                                    <input type="email" class="form-control form-control-sm" value="" onchange="updatePartnerInfo(8, 'email', this.value)">
                                </td>
                                <td>
                                    <input type="tel" class="form-control form-control-sm" value="" onchange="updatePartnerInfo(8, 'phone', this.value)">
                                </td>
                                <td>
                                    <input type="file" class="form-control form-control-sm" accept=".pdf" onchange="uploadPDF(8, this)">
                                    <button class="btn btn-outline-primary btn-sm mt-1" onclick="previewPDF(8)" style="display: none;" id="previewBtn8">
                                        <i class="bi bi-file-pdf"></i> PDF
                                    </button>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ページネーション -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- フッター -->
    <div id="footer-container"></div>

    <!-- 外部業務依頼追加モーダル -->
    <div class="modal fade" id="addPartnerModal" tabindex="-1" aria-labelledby="addPartnerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addPartnerModalLabel">新規外部業務依頼登録</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
                </div>
                <div class="modal-body">
                    <form id="partnerForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="companyName" class="form-label">会社名 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="companyName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="licenseNumber" class="form-label">許可・登録番号</label>
                                    <input type="text" class="form-control" id="licenseNumber" placeholder="建設業許可番号等">
                                </div>
                                <div class="mb-3">
                                    <label for="contactPerson" class="form-label">担当者名 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="contactPerson" required>
                                </div>
                                <div class="mb-3">
                                    <label for="phone" class="form-label">電話番号 <span class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" id="phone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">メールアドレス <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="services" class="form-label">提供サービス <span class="text-danger">*</span></label>
                                    <select class="form-select" id="services" multiple required>
                                        <option value="construction">建設業</option>
                                        <option value="design">設計</option>
                                        <option value="survey">測量</option>
                                        <option value="consulting">コンサルティング</option>
                                        <option value="renovation">リフォーム</option>
                                        <option value="newconstruction">新築</option>
                                        <option value="supervision">監理</option>
                                        <option value="planning">企画</option>
                                        <option value="investigation">調査</option>
                                    </select>
                                    <small class="form-text text-muted">Ctrlキーを押しながら複数選択できます</small>
                                </div>
                                <div class="mb-3">
                                    <label for="contractStart" class="form-label">契約開始日 <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="contractStart" required>
                                </div>
                                <div class="mb-3">
                                    <label for="notes" class="form-label">備考</label>
                                    <textarea class="form-control" id="notes" rows="3" placeholder="特記事項や注意点"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary" onclick="savePartner()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../style.js"></script>
    <script>
        // ヘッダー＆フッター読み込み
        fetch('provider_header.html').then(r=>r.text()).then(html=>document.getElementById('header-container').innerHTML=html);
        fetch('provider_footer.html').then(r=>r.text()).then(html=>document.getElementById('footer-container').innerHTML=html);

        // 新規外部業務依頼追加モーダルを開く
        function openAddPartnerModal() {
            // フォームをクリア
            document.getElementById('partnerForm').reset();
            
            // 今日の日付をデフォルトに設定
            document.getElementById('contractStart').value = new Date().toISOString().split('T')[0];
            
            const modal = new bootstrap.Modal(document.getElementById('addPartnerModal'));
            modal.show();
        }

        // 外部業務依頼を保存
        function savePartner() {
            const companyName = document.getElementById('companyName').value;
            const contactPerson = document.getElementById('contactPerson').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const services = Array.from(document.getElementById('services').selectedOptions).map(option => option.value);
            const contractStart = document.getElementById('contractStart').value;

            if (!companyName || !contactPerson || !phone || !email || services.length === 0 || !contractStart) {
                alert('必須項目を入力してください');
                return;
            }

            alert(`${companyName} を外部業務依頼として登録しました`);
            
            // モーダルを閉じる
            const modal = bootstrap.Modal.getInstance(document.getElementById('addPartnerModal'));
            modal.hide();
        }

        // 外部業務依頼を編集
        function editPartner(partnerId) {
            alert(`外部業務依頼ID ${partnerId} を編集します`);
        }

        // パートナー情報を更新
        function updatePartnerInfo(partnerId, field, value) {
            alert(`外部業務依頼ID ${partnerId} の${field}を「${value}」に更新しました`);
        }

        // PDFファイルをアップロード
        function uploadPDF(id, input) {
            const file = input.files[0];
            if (file) {
                if (file.type === 'application/pdf') {
                    // PDFファイルが選択された場合、プレビューボタンを表示
                    const previewBtn = document.getElementById(`previewBtn${id}`);
                    previewBtn.style.display = 'inline-block';
                    previewBtn.setAttribute('data-filename', file.name);
                    
                    // ファイル名をボタンに表示
                    previewBtn.innerHTML = `<i class="bi bi-file-pdf"></i> ${file.name}`;
                    
                    console.log(`パートナー${id}にPDFファイル「${file.name}」をアップロード`);
                } else {
                    alert('PDFファイルのみアップロード可能です。');
                    input.value = '';
                }
            }
        }

        // PDFファイルをプレビュー
        function previewPDF(id) {
            const previewBtn = document.getElementById(`previewBtn${id}`);
            const filename = previewBtn.getAttribute('data-filename');
            
            if (filename) {
                // 新しいタブでPDFを開く
                const fileInput = previewBtn.parentElement.querySelector('input[type="file"]');
                const file = fileInput.files[0];
                
                if (file) {
                    const url = URL.createObjectURL(file);
                    window.open(url, '_blank');
                }
            } else {
                alert('PDFファイルがアップロードされていません。');
            }
        }

        // サービス詳細モーダルを開く
        function openServiceModal(serviceName) {
            alert(`${serviceName} のサービス詳細PDFを表示します`);
        }

        // フィルターを適用
        function applyFilters() {
            alert('フィルターを適用しました');
        }
    </script>
</body>
</html>
