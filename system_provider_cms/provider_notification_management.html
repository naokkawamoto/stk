<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>お知らせ管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../style.css">
    <style>
        .unread {
            background-color: #f8f9fa;
            border-left: 4px solid #dc3545;
        }
        .read {
            background-color: #ffffff;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <div class="container-fluid mt-4 px-3">
        <!-- ページタイトル -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0">お知らせ管理</h4>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createNotificationModal">
                <i class="bi bi-plus-circle"></i> 新規作成
            </button>
        </div>

        <!-- 統計情報 -->
        <div class="alert alert-info">
            <div class="row">
                <div class="col-md-6">
                    <strong>お知らせ数:</strong> <span id="totalNotifications">12</span>件
                </div>
                <div class="col-md-6">
                    <strong>公開数:</strong> <span id="activeNotifications">8</span>件
                </div>
            </div>
        </div>

        <!-- フィルター・検索 -->
        <div class="row mb-3">
            <div class="col-md-4">
                <select class="form-select" id="statusFilter">
                    <option value="">すべてのステータス</option>
                    <option value="active">公開</option>
                    <option value="inactive">非公開</option>
                </select>
            </div>
            <div class="col-md-8">
                <input type="text" class="form-control" placeholder="お知らせを検索..." id="searchInput">
            </div>
        </div>

        <!-- お知らせ一覧 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">お知らせ一覧</h5>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush" id="notificationList">
                    <!-- お知らせ1 -->
                    <div class="list-group-item unread" data-id="1" data-status="active">
                        <div class="d-flex w-100 justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-1">2025-05-01 GW営業時間のお知らせ</h6>
                                    <div>
                                        <span class="badge bg-success me-2">公開</span>
                                    </div>
                                </div>
                                <p class="mb-2">弊社ゴールデンウィーク期間中の営業時間は通常と異なりますのでご注意ください。お問い合わせはお早めに。</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> 2025-05-01 10:00 公開
                                        <i class="bi bi-eye"></i> 既読: 45人 / 未読: 12人
                                    </small>
                                    <div>
                                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editNotification(1)">
                                            <i class="bi bi-pencil"></i> 編集
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleStatus(1)">
                                            <i class="bi bi-pause"></i> 非公開
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- お知らせ2 -->
                    <div class="list-group-item read" data-id="2" data-status="active">
                        <div class="d-flex w-100 justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-1">2025-04-20 メンテナンス通知</h6>
                                    <div>
                                        <span class="badge bg-success me-2">公開</span>
                                    </div>
                                </div>
                                <p class="mb-2">4月25日深夜にシステムメンテナンスを実施します。サービス停止は約30分を予定しています。</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> 2025-04-20 14:30 公開
                                        <i class="bi bi-eye"></i> 既読: 58人 / 未読: 0人
                                    </small>
                                    <div>
                                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editNotification(2)">
                                            <i class="bi bi-pencil"></i> 編集
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleStatus(2)">
                                            <i class="bi bi-pause"></i> 非公開
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- お知らせ3 -->
                    <div class="list-group-item unread" data-id="3" data-status="active">
                        <div class="d-flex w-100 justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-1">2025-03-15 新機能リリースのお知らせ</h6>
                                    <div>
                                        <span class="badge bg-success me-2">公開</span>
                                    </div>
                                </div>
                                <p class="mb-2">見積作成画面に新たにフィルター機能を追加しました。より迅速に案件を検索いただけます。</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> 2025-03-15 09:00 公開
                                        <i class="bi bi-eye"></i> 既読: 32人 / 未読: 25人
                                    </small>
                                    <div>
                                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editNotification(3)">
                                            <i class="bi bi-pencil"></i> 編集
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="toggleStatus(3)">
                                            <i class="bi bi-pause"></i> 非公開
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- お知らせ4 -->
                    <div class="list-group-item read" data-id="4" data-status="inactive">
                        <div class="d-flex w-100 justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-1">2025-02-28 システムアップデート完了</h6>
                                    <div>
                                        <span class="badge bg-secondary me-2">非公開</span>
                                    </div>
                                </div>
                                <p class="mb-2">システムのアップデートが完了しました。新機能をご利用いただけます。</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> 2025-02-28 16:00 公開
                                        <i class="bi bi-eye"></i> 既読: 60人 / 未読: 0人
                                    </small>
                                    <div>
                                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editNotification(4)">
                                            <i class="bi bi-pencil"></i> 編集
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" onclick="toggleStatus(4)">
                                            <i class="bi bi-play"></i> 公開
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- ページネーション -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- フッター -->
    <div id="footer-container"></div>

    <!-- 新規作成モーダル -->
    <div class="modal fade" id="createNotificationModal" tabindex="-1" aria-labelledby="createNotificationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createNotificationModalLabel">お知らせ新規作成</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
                </div>
                <div class="modal-body">
                    <form id="createNotificationForm">
                        <div class="mb-3">
                            <label for="notificationTitle" class="form-label">タイトル</label>
                            <input type="text" class="form-control" id="notificationTitle" placeholder="お知らせのタイトルを入力してください" required>
                        </div>
                        <div class="mb-3">
                            <label for="notificationContent" class="form-label">内容</label>
                            <textarea class="form-control" id="notificationContent" rows="6" placeholder="お知らせの内容を入力してください" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="notificationStatus" class="form-label">ステータス</label>
                                    <select class="form-select" id="notificationStatus">
                                        <option value="active">公開</option>
                                        <option value="inactive">非公開</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="notificationDate" class="form-label">公開日時</label>
                                    <input type="datetime-local" class="form-control" id="notificationDate">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="notificationTarget" class="form-label">配信対象</label>
                            <select class="form-select" id="notificationTarget">
                                <option value="all">全ユーザー</option>
                                <option value="active">アクティブユーザーのみ</option>
                                <option value="premium">プレミアムユーザーのみ</option>
                                <option value="free">フリーユーザーのみ</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary" onclick="createNotification()">作成</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../style.js"></script>
    <script>
        // ヘッダー＆フッター読み込み
        fetch('provider_header.html').then(r=>r.text()).then(html=>document.getElementById('header-container').innerHTML=html);
        fetch('provider_footer.html').then(r=>r.text()).then(html=>document.getElementById('footer-container').innerHTML=html);

        // フィルター機能
        document.getElementById('statusFilter').addEventListener('change', filterNotifications);
        document.getElementById('searchInput').addEventListener('input', filterNotifications);

        function filterNotifications() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const notifications = document.querySelectorAll('.list-group-item');
            
            notifications.forEach(notification => {
                const status = notification.getAttribute('data-status');
                const title = notification.querySelector('h6').textContent.toLowerCase();
                const content = notification.querySelector('p').textContent.toLowerCase();
                
                let show = true;
                
                // ステータスフィルター
                if (statusFilter && status !== statusFilter) {
                    show = false;
                }
                
                // 検索フィルター
                if (searchTerm && !title.includes(searchTerm) && !content.includes(searchTerm)) {
                    show = false;
                }
                
                notification.style.display = show ? 'block' : 'none';
            });
        }


        // ステータス切り替え（公開/非公開）
        function toggleStatus(id) {
            const notification = document.querySelector(`[data-id="${id}"]`);
            const statusBadge = notification.querySelector('.badge.bg-success, .badge.bg-secondary, .badge.bg-warning');
            const button = notification.querySelector('button[onclick*="toggleStatus"]');
            const currentStatus = notification.getAttribute('data-status');
            
            if (currentStatus === 'active') {
                // 公開 → 非公開
                notification.setAttribute('data-status', 'inactive');
                statusBadge.className = 'badge bg-secondary me-2';
                statusBadge.textContent = '非公開';
                button.innerHTML = '<i class="bi bi-play"></i> 公開';
                button.className = 'btn btn-outline-success btn-sm';
            } else if (currentStatus === 'inactive') {
                // 非公開 → 公開
                notification.setAttribute('data-status', 'active');
                statusBadge.className = 'badge bg-success me-2';
                statusBadge.textContent = '公開';
                button.innerHTML = '<i class="bi bi-pause"></i> 非公開';
                button.className = 'btn btn-outline-warning btn-sm';
            }
            
            updateStats();
        }


        // 統計情報更新
        function updateStats() {
            const totalNotifications = document.querySelectorAll('.list-group-item').length;
            const activeNotifications = document.querySelectorAll('[data-status="active"]').length;
            
            document.getElementById('totalNotifications').textContent = totalNotifications;
            document.getElementById('activeNotifications').textContent = activeNotifications;
        }

        // お知らせ編集
        function editNotification(id) {
            alert(`お知らせID ${id} を編集します`);
            // 実際の実装では編集モーダルを開く
        }


        // 新規お知らせ作成
        function createNotification() {
            const title = document.getElementById('notificationTitle').value;
            const content = document.getElementById('notificationContent').value;
            const status = document.getElementById('notificationStatus').value;
            const date = document.getElementById('notificationDate').value;
            const target = document.getElementById('notificationTarget').value;
            
            if (!title || !content) {
                alert('タイトルと内容は必須です');
                return;
            }
            
            // 実際の実装ではサーバーに送信
            alert('お知らせを作成しました');
            
            // モーダルを閉じる
            const modal = bootstrap.Modal.getInstance(document.getElementById('createNotificationModal'));
            modal.hide();
            
            // フォームをリセット
            document.getElementById('createNotificationForm').reset();
        }

        // ページ読み込み時に統計を更新
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
        });
    </script>
</body>
</html>
