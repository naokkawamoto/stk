<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>フロアプランエディター</title>
  
  <!-- React & React DOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Konva -->
  <script src="https://unpkg.com/konva@9/konva.min.js"></script>
  
  <!-- React Konva -->
  <script src="https://unpkg.com/react-konva@18/lib/ReactKonvaCore.umd.js"></script>
  <script src="https://unpkg.com/react-konva@18/lib/ReactKonva.umd.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    .floorplan-container {
      background: #f8f9fa;
      min-height: 100vh;
      padding: 20px;
    }
    
    .toolbar {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .canvas-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .room-info {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .room-item {
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .room-item:hover {
      background-color: #f8f9fa;
    }
    
    .room-item.selected {
      background-color: #e3f2fd;
      border-left: 4px solid #2196f3;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function FloorplanEditor() {
      const [rooms, setRooms] = useState([
        { 
          id: 1, 
          name: "LDK", 
          x: 50, 
          y: 50, 
          width: 200, 
          height: 150, 
          fill: "#e0f7fa",
          area: "20帖",
          type: "リビング・ダイニング・キッチン"
        },
        { 
          id: 2, 
          name: "和室", 
          x: 270, 
          y: 50, 
          width: 120, 
          height: 150, 
          fill: "#fce4ec",
          area: "8帖",
          type: "和室"
        },
        { 
          id: 3, 
          name: "寝室", 
          x: 50, 
          y: 220, 
          width: 150, 
          height: 120, 
          fill: "#e8f5e8",
          area: "12帖",
          type: "洋室"
        },
        { 
          id: 4, 
          name: "浴室", 
          x: 220, 
          y: 220, 
          width: 80, 
          height: 80, 
          fill: "#fff3e0",
          area: "4帖",
          type: "浴室"
        },
        { 
          id: 5, 
          name: "トイレ", 
          x: 320, 
          y: 220, 
          width: 60, 
          height: 80, 
          fill: "#f3e5f5",
          area: "2帖",
          type: "トイレ"
        }
      ]);

      const [selectedRoomId, setSelectedRoomId] = useState(null);

      const handleRoomClick = (id) => {
        setSelectedRoomId(id);
      };

      const addRoom = () => {
        const newRoom = {
          id: rooms.length + 1,
          name: "新規部屋",
          x: 100,
          y: 100,
          width: 100,
          height: 100,
          fill: "#fff9c4",
          area: "6帖",
          type: "洋室"
        };
        setRooms([...rooms, newRoom]);
      };

      const deleteRoom = () => {
        if (selectedRoomId) {
          setRooms(rooms.filter(room => room.id !== selectedRoomId));
          setSelectedRoomId(null);
        }
      };

      const selectedRoom = rooms.find(room => room.id === selectedRoomId);

      return (
        <div className="floorplan-container">
          <div className="container-fluid">
            <div className="row">
              <div className="col-md-9">
                {/* ツールバー */}
                <div className="toolbar">
                  <div className="d-flex justify-content-between align-items-center">
                    <div>
                      <h5 className="mb-0">
                        <i className="bi bi-house-door me-2"></i>
                        フロアプランエディター
                      </h5>
                    </div>
                    <div className="btn-group">
                      <button className="btn btn-primary" onClick={addRoom}>
                        <i className="bi bi-plus-circle me-2"></i>
                        部屋を追加
                      </button>
                      <button 
                        className="btn btn-danger" 
                        onClick={deleteRoom}
                        disabled={!selectedRoomId}
                      >
                        <i className="bi bi-trash me-2"></i>
                        部屋を削除
                      </button>
                    </div>
                  </div>
                </div>

                {/* キャンバス */}
                <div className="canvas-container">
                  <div style={{ 
                    width: '100%', 
                    height: '600px', 
                    border: '2px solid #ddd',
                    borderRadius: '8px',
                    position: 'relative',
                    background: 'white'
                  }}>
                    {/* 背景グリッド */}
                    <svg width="100%" height="100%" style={{ position: 'absolute', top: 0, left: 0 }}>
                      <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                          <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" strokeWidth="1" opacity="0.3"/>
                        </pattern>
                      </defs>
                      <rect width="100%" height="100%" fill="url(#grid)" />
                    </svg>
                    
                    {/* 部屋 */}
                    {rooms.map((room) => (
                      <div
                        key={room.id}
                        style={{
                          position: 'absolute',
                          left: room.x,
                          top: room.y,
                          width: room.width,
                          height: room.height,
                          backgroundColor: room.fill,
                          border: room.id === selectedRoomId ? '3px solid #2196f3' : '2px solid #666',
                          borderRadius: '4px',
                          cursor: 'pointer',
                          boxShadow: room.id === selectedRoomId ? '0 4px 8px rgba(0,0,0,0.3)' : 'none',
                          transition: 'all 0.2s'
                        }}
                        onClick={() => handleRoomClick(room.id)}
                      >
                        <div style={{
                          position: 'absolute',
                          top: '10px',
                          left: '10px',
                          fontSize: '16px',
                          fontWeight: 'bold',
                          color: '#333'
                        }}>
                          {room.name}
                        </div>
                        <div style={{
                          position: 'absolute',
                          top: '35px',
                          left: '10px',
                          fontSize: '12px',
                          color: '#666'
                        }}>
                          {room.area}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* サイドバー */}
              <div className="col-md-3">
                <div className="room-info">
                  <h6 className="mb-3">
                    <i className="bi bi-list-ul me-2"></i>
                    部屋一覧
                  </h6>
                  <div className="list-group list-group-flush">
                    {rooms.map((room) => (
                      <div 
                        key={room.id}
                        className={`list-group-item room-item ${room.id === selectedRoomId ? 'selected' : ''}`}
                        onClick={() => handleRoomClick(room.id)}
                      >
                        <div className="d-flex justify-content-between align-items-center">
                          <div>
                            <strong>{room.name}</strong>
                            <br />
                            <small className="text-muted">{room.area} - {room.type}</small>
                          </div>
                          <div 
                            style={{
                              width: 20,
                              height: 20,
                              backgroundColor: room.fill,
                              border: '1px solid #ccc',
                              borderRadius: '3px'
                            }}
                          ></div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {selectedRoom && (
                  <div className="room-info">
                    <h6 className="mb-3">
                      <i className="bi bi-info-circle me-2"></i>
                      選択中の部屋
                    </h6>
                    <div className="card">
                      <div className="card-body">
                        <h6 className="card-title">{selectedRoom.name}</h6>
                        <p className="card-text">
                          <strong>面積:</strong> {selectedRoom.area}<br />
                          <strong>タイプ:</strong> {selectedRoom.type}<br />
                          <strong>位置:</strong> ({selectedRoom.x}, {selectedRoom.y})<br />
                          <strong>サイズ:</strong> {selectedRoom.width} × {selectedRoom.height}
                        </p>
                        <div className="d-grid gap-2">
                          <button className="btn btn-outline-primary btn-sm">
                            <i className="bi bi-pencil me-2"></i>
                            編集
                          </button>
                          <button className="btn btn-outline-secondary btn-sm">
                            <i className="bi bi-gear me-2"></i>
                            詳細設定
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // アプリケーションのレンダリング
    ReactDOM.render(<FloorplanEditor />, document.getElementById('root'));
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 